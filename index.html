<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Free Fire Likes Tool</title>
  <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
  <style>
    /* (Paste your existing CSS here exactly as you had it) */
    :root{--bg:#071025;--card:linear-gradient(145deg,#0f1724,#0b1220);--muted:#9aa8b8;--text:#e6eef6;--accent:#22d3ee;--accent-2:#38bdf8;--success:#22c55e;--glass:rgba(255,255,255,0.03)}
    *{box-sizing:border-box}html,body{height:100%}body{margin:0;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans",Arial;background:radial-gradient(700px 300px at 10% -20%,rgba(34,211,238,.05),transparent 40%),radial-gradient(500px 200px at 95% 0%,rgba(56,189,248,.03),transparent 40%),var(--bg);color:var(--text);display:grid;place-items:center;padding:28px}
    .wrap{width:min(820px,100%);padding:18px}.card{background:var(--card);border-radius:14px;padding:22px;box-shadow:0 14px 40px rgba(2,6,23,0.6);border:1px solid rgba(255,255,255,0.03)}header{display:flex;align-items:center;gap:14px}.logo{width:58px;height:58px;border-radius:12px;display:grid;place-items:center;background:linear-gradient(135deg,var(--accent),var(--accent-2));color:#001018;font-weight:900;font-size:18px;box-shadow:0 6px 18px rgba(34,211,238,0.12);flex-shrink:0}h1{margin:0;font-size:20px}.powered{color:var(--muted);font-size:13px;margin-top:4px}form{margin-top:18px}label{display:block;font-weight:700;margin:10px 0 6px;color:var(--muted);font-size:13px}input, select, button{width:100%;padding:12px 14px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:#06121b;color:var(--text);outline:none;font-size:15px}select.opt{appearance:none} .small{font-size:13px;color:var(--muted);margin-top:10px}.btn{margin-top:14px;display:inline-flex;align-items:center;justify-content:center;gap:10px;background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#001018;border:none;padding:12px 16px;border-radius:12px;font-weight:800;cursor:pointer}.spinner{width:18px;height:18px;border-radius:50%;border:3px solid rgba(255,255,255,0.3);border-top-color:white;animation:spin .9s linear infinite}@keyframes spin{to{transform:rotate(360deg)}}.overlay{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.6);visibility:hidden;opacity:0;transition:opacity .26s ease}.overlay.active{visibility:visible;opacity:1}.dialog{width:min(680px,94%);background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:18px;border-radius:12px;box-shadow:0 18px 48px rgba(2,6,23,0.6)}.msg{background:#041019;border-radius:10px;padding:12px;font-size:15px;color:var(--text);margin-top:12px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <header>
        <div class="logo">FF</div>
        <div>
          <h1>Free Fire Likes Tool</h1>
          <div class="powered">powered by <strong>sheikh zada</strong></div>
        </div>
      </header>

      <form id="likeForm" autocomplete="off">
        <label for="uid">Target UID (who will receive likes)</label>
        <input id="uid" name="uid" type="text" placeholder="e.g. 12345678" required />

        <label for="region" style="margin-top:12px">Select Server (or auto)</label>
        <select id="region" class="opt" name="region">
          <option value="PK">ðŸ‡µðŸ‡° Pakistan</option>
          <option value="IN">ðŸ‡®ðŸ‡³ India</option>
          <option value="BD">ðŸ‡§ðŸ‡© Bangladesh</option>
          <option value="BR">ðŸ‡§ðŸ‡· Brazil</option>
          <option value="SG">ðŸ‡¸ðŸ‡¬ Singapore</option>
          <option value="ID">ðŸ‡®ðŸ‡© Indonesia</option>
        </select>

        <!-- Turnstile widget -->
        <div style="margin-top:12px" class="cf-turnstile" data-sitekey="0x4AAAAAABz1wzZtK3fkkuWK"></div>

        <button id="submitBtn" class="btn" type="submit"><span id="btnText">Submit</span></button>
        <div class="small">Each source token will try once per request. You control tokens server-side.</div>
      </form>
    </div>
  </div>

  <div class="overlay" id="overlay" aria-hidden="true">
    <div class="dialog">
      <div class="msg" id="messageBox">Waiting...</div>
      <div style="text-align:center;margin-top:12px"><button onclick="document.getElementById('overlay').classList.remove('active')">Close</button></div>
    </div>
  </div>

<script>
  // auto-detect region (best-effort)
  (async function(){
    try{
      const r = await fetch('https://ipapi.co/json/');
      if(!r.ok) return;
      const j = await r.json();
      const map = {PK:'PK',IN:'IN',BD:'BD',BR:'BR',SG:'SG',ID:'ID'};
      if(j && j.country && map[j.country.toUpperCase()]) document.getElementById('region').value = map[j.country.toUpperCase()];
    }catch(e){}
  })();

  const form = document.getElementById('likeForm');
  const uidInput = document.getElementById('uid');
  const regionSelect = document.getElementById('region');
  const submitBtn = document.getElementById('submitBtn');
  const btnText = document.getElementById('btnText');
  const overlay = document.getElementById('overlay');
  const messageBox = document.getElementById('messageBox');

  function setLoading(on){
    if(on){ btnText.innerHTML = '<span class="spinner"></span>'; submitBtn.disabled = true;}
    else { btnText.textContent = 'Submit'; submitBtn.disabled = false; }
  }
  function showPopup(html){
    messageBox.innerHTML = html;
    overlay.classList.add('active');
    overlay.setAttribute('aria-hidden','false');
  }

  form.addEventListener('submit', async (e)=>{
    e.preventDefault();
    const uid = uidInput.value.trim();
    const region = regionSelect.value || 'PK';
    if(!uid || !/^\d{4,}$/.test(uid)){ showPopup('<strong>Error:</strong> Enter valid UID'); return; }

    // Turnstile token input created by CF widget
    const t = document.querySelector('[name="cf-turnstile-response"]')?.value;
    if(!t){ showPopup('<strong>Error:</strong> Please complete the verification.'); return; }

    setLoading(true);
    try{
      const payload = { targetUid: uid, targetRegion: region, cfToken: t, amount: 0 /*0 => backend random 95-100*/ };
      const res = await fetch('/api/send', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload) });
      const data = await res.json();
      // data will contain attempts array
      if(data.error) {
        showPopup('<strong>Error:</strong> '+data.error);
      } else {
        // pretty print results
        let html = `<strong>Results:</strong><br><small>Attempted with ${data.attempts.length} source tokens</small><br><ul style="text-align:left;margin-top:8px">`;
        data.attempts.forEach(a=>{
          html += `<li><strong>${a.sourceId}</strong>: status=${a.status} â€” ${a.summary}</li>`;
        });
        html += `</ul>`;
        showPopup(html);
      }
    }catch(err){
      showPopup('<strong>Network error:</strong> '+err.message);
    }finally{
      setLoading(false);
    }
  });
</script>
</body>
</html>
